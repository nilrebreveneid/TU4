<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Engine Quiz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: linear-gradient(135deg, #e0e7ff, #c3dafe); margin: 0; padding: 2rem; color: #333; min-height: 100vh; }
        .quiz-container { max-width: 900px; margin: auto; background: #fff; padding: 2rem; border-radius: 16px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        h1 { text-align: center; margin-bottom: 1.5rem; color: #1e3a8a; font-size: 2rem; font-weight: 700; }
        h2 { text-align: center; color: #1e3a8a; margin: 1rem 0; }
        .quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; }
        .timer { font-size: 1.2rem; font-weight: 600; color: #d81b60; }
        .progress-bar { width: 100%; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-bottom: 1.5rem; }
        .progress { height: 100%; background: #3b82f6; transition: width 0.3s ease; }
        .question { margin-bottom: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px; animation: fadeIn 0.5s; transition: transform 0.2s ease; }
        .question:hover { transform: translateY(-2px); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .question p { font-size: 1.2rem; font-weight: 600; color: #1e3a8a; margin-bottom: 1rem; }
        .options button { display: block; width: 100%; padding: 1rem; margin: 0.5rem 0; background: #ffffff; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; text-align: left; color: #374151; }
        .options button:hover:not(:disabled) { background: #f3f4f6; border-color: #3b82f6; transform: translateX(4px); }
        .options button.correct { background: #bbf7d0; border-color: #22c55e; color: #166534; animation: pulse 0.5s; }
        .options button.wrong { background: #fecaca; border-color: #ef4444; color: #991b1b; animation: shake 0.3s; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .options button:disabled { cursor: not-allowed; opacity: 0.7; }
        .explanation { display: none; margin-top: 1rem; padding: 1rem; background: #eff6ff; border-radius: 8px; color: #1e3a8a; font-size: 0.95rem; }
        .skip-button { background: #fff3cd; margin-top: 1rem; padding: 0.75rem; width: 100%; border: 1px solid #ffca28; border-radius: 8px; cursor: pointer; transition: background 0.3s ease; }
        .skip-button:hover { background: #ffecb3; }
        .next-button { background: #3b82f6; color: #fff; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; margin-top: 1rem; display: block; width: 100%; text-align: center; transition: background 0.3s ease; }
        .next-button:hover:not(:disabled) { background: #2563eb; }
        .next-button:disabled { background: #ccc; cursor: not-allowed; }
        .score-container { text-align: center; margin-top: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 12px; }
        .score { font-size: 1.5rem; font-weight: 700; color: #1e3a8a; }
        .results-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.95rem; }
        .results-table th, .results-table td { border: 1px solid #e5e7eb; padding: 0.75rem; text-align: left; }
        .results-table th { background: #f8fafc; color: #1e3a8a; font-weight: 600; }
        .results-table .correct { color: #166534; font-weight: bold; }
        .results-table .wrong { color: #991b1b; font-weight: bold; }
        .results-table .skipped, .results-table .not-attempted { color: #d97706; font-weight: bold; }
        .hidden { display: none; }
        .restart-button { background: #22c55e; color: #fff; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; margin: 1rem auto; display: block; width: 100%; text-align: center; transition: background 0.3s ease; }
        .restart-button:hover { background: #16a34a; }
        @media (max-width: 600px) { body { padding: 1rem; } .quiz-container { padding: 1rem; } h1 { font-size: 1.8rem; } .question p { font-size: 1rem; } .options button, .skip-button, .next-button, .restart-button { font-size: 0.9rem; padding: 0.8rem; } .results-table th, .results-table td { padding: 0.5rem; font-size: 0.85rem; } }
    </style>
</head>
<body>
    <div class="quiz-container">
        <h1>Engine Quiz</h1>
        <div class="quiz-header">
            <div class="timer" id="timer">Time: 00:00</div>
            <div class="score" id="current-score">Score: 0/59</div>
        </div>
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        <div id="quiz"></div>
        <div class="score-container">
            <div class="score" id="score"></div>
            <div id="results" class="hidden">
                <h2>Quiz Results</h2>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Question</th>
                            <th>Your Answer</th>
                            <th>Correct Answer</th>
                            <th>Status</th>
                            <th>Explanation</th>
                        </tr>
                    </thead>
                    <tbody id="results-body"></tbody>
                </table>
                <button class="restart-button" onclick="restartQuiz()">Restart Quiz</button>
            </div>
        </div>
    </div>

    <audio id="correct-sound" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
    <audio id="wrong-sound" src="https://www.soundjay.com/buttons/beep-02.mp3"></audio>

    <script>
        const questions = [
            // 4.1 Two Stroke and Four Stroke Engines
            {
                q: "In a two-stroke engine, power is generated on:",
                options: ["Half revolution", "One revolution of crankshaft", "Two revolutions", "Every stroke"],
                answer: 1,
                explanation: "A two-stroke engine generates power once per crankshaft revolution, as it completes the cycle in one revolution."
            },
            {
                q: "In a four-stroke cycle engine, the sequence of operation is:",
                options: ["Expansion, compression, suction, exhaust", "Suction, compression, expansion, exhaust", "Compression, suction, exhaust, expansion", "Suction, exhaust, compression, expansion"],
                answer: 1,
                explanation: "The four-stroke cycle follows suction (intake), compression, expansion (power), and exhaust in that order."
            },
            {
                q: "The four operations in a 4-stroke engine are completed in how many crankshaft revolutions?",
                options: ["1", "2", "3", "4"],
                answer: 1,
                explanation: "A four-stroke engine completes its cycle (suction, compression, expansion, exhaust) in two crankshaft revolutions."
            },
            {
                q: "In a four-stroke engine, which stroke is known as the power stroke?",
                options: ["Compression stroke", "Expansion stroke", "Suction stroke", "Exhaust stroke"],
                answer: 1,
                explanation: "The expansion stroke, where combustion drives the piston, is the power stroke in a four-stroke engine."
            },
            {
                q: "For the same power, a two-stroke cycle engine occupies:",
                options: ["More space", "Less space", "Same space", "Double the space"],
                answer: 1,
                explanation: "Two-stroke engines are more compact for the same power due to their simpler design and fewer moving parts."
            },
            {
                q: "A two-stroke cycle engine uses the fuel:",
                options: ["Steam only", "Petrol and air only", "Diesel only", "Petrol or diesel mixed with oil"],
                answer: 3,
                explanation: "Two-stroke engines typically use a petrol or diesel mixture with oil for lubrication, as they lack a separate oil sump."
            },
            {
                q: "The four operations (suction, compression, expansion, exhaust) in 4-stroke engines are completed in:",
                options: ["4 revolutions", "2 revolutions of the crankshaft", "1 revolution", "3 revolutions"],
                answer: 1,
                explanation: "A four-stroke engine completes its cycle in two crankshaft revolutions."
            },
            {
                q: "In four-stroke engines, the power stroke is also known as:",
                options: ["Exhaust stroke", "Expansion stroke", "Compression stroke", "Suction stroke"],
                answer: 1,
                explanation: "The power stroke, where combustion occurs, is also called the expansion stroke."
            },
            {
                q: "Suction, ignition, expansion, and exhaust strokes take place in:",
                options: ["Petrol engine", "Four-stroke petrol engine", "Two-stroke diesel engine", "Steam engine"],
                answer: 1,
                explanation: "These strokes occur specifically in a four-stroke petrol engine, which uses spark ignition."
            },
            {
                q: "Compared to the life of a spark plug in a two-stroke engine, the spark plug life of a four-stroke engine is approximately:",
                options: ["Half", "Twice", "Same", "Quarter"],
                answer: 1,
                explanation: "Four-stroke engines fire spark plugs once every two revolutions, doubling their life compared to two-stroke engines."
            },
            {
                q: "Otto cycle is related to:",
                options: ["Diesel engine", "Petrol engine", "Steam engine", "Gas turbine"],
                answer: 1,
                explanation: "The Otto cycle is the thermodynamic cycle used in petrol (spark-ignition) engines."
            },
            {
                q: "Air is compressed to a high pressure, fuel is injected at a temperature above ignition point which burns nearly at constant pressure. Such cycle is called:",
                options: ["Otto cycle", "Diesel cycle", "Carnot cycle", "Rankine cycle"],
                answer: 1,
                explanation: "The Diesel cycle involves compression-ignition and fuel burning at near-constant pressure."
            },
            {
                q: "What is a key advantage of a two-stroke engine over a four-stroke engine?",
                options: ["Higher fuel efficiency", "Simpler design with fewer moving parts", "Longer lifespan", "Lower emissions"],
                answer: 1,
                explanation: "Two-stroke engines have a simpler design with fewer moving parts, reducing complexity and cost."
            },
            {
                q: "In a four-stroke engine, how many power strokes occur per two crankshaft revolutions?",
                options: ["One", "Two", "Three", "Four"],
                answer: 0,
                explanation: "A four-stroke engine produces one power stroke per two revolutions due to its four-stroke cycle."
            },
            {
                q: "Which component is critical for scavenging in a two-stroke engine?",
                options: ["Crankshaft", "Reed valve", "Camshaft", "Piston rings"],
                answer: 1,
                explanation: "The reed valve assists in scavenging by controlling the intake of fresh air-fuel mixture in two-stroke engines."
            },

            // 4.2 Petrol and Diesel Engines
            {
                q: "Which of the following part is not present in a diesel engine?",
                options: ["Oil ring", "Spark plug", "Piston", "Fuel injector"],
                answer: 1,
                explanation: "Diesel engines use compression ignition, not spark plugs, which are found in petrol engines."
            },
            {
                q: "The camshaft of a 4-stroke I.C. engine running at 1500 rpm will run at:",
                options: ["3000 rpm", "750 rpm", "1500 rpm", "1000 rpm"],
                answer: 1,
                explanation: "The camshaft runs at half the crankshaft speed in a 4-stroke engine, so 1500 rpm ÷ 2 = 750 rpm."
            },
            {
                q: "Otto cycle is related to:",
                options: ["Diesel engine", "Petrol engine", "Steam engine", "Gas turbine"],
                answer: 1,
                explanation: "The Otto cycle is the thermodynamic cycle used in petrol (spark-ignition) engines."
            },
            {
                q: "Air is compressed to a high pressure, fuel is injected at a temperature above ignition point which burns nearly at constant pressure. Such cycle is called:",
                options: ["Otto cycle", "Diesel cycle", "Carnot cycle", "Rankine cycle"],
                answer: 1,
                explanation: "The Diesel cycle involves compression-ignition and fuel burning at near-constant pressure."
            },
            {
                q: "In which of the following is a fuel injector used?",
                options: ["Spark-ignition engines", "Compression-ignition engines", "Steam engines", "Electric engines"],
                answer: 1,
                explanation: "Fuel injectors are used in compression-ignition (diesel) engines for precise fuel delivery."
            },
            {
                q: "Which engine type relies on a spark plug for ignition?",
                options: ["Diesel engine", "Petrol engine", "Both", "Neither"],
                answer: 1,
                explanation: "Petrol engines use a spark plug to ignite the air-fuel mixture, unlike diesel engines."
            },
            {
                q: "What is the primary difference in fuel ignition between petrol and diesel engines?",
                options: ["Spark ignition vs. compression ignition", "Fuel injection vs. carburetor", "High vs. low compression", "Turbocharged vs. naturally aspirated"],
                answer: 0,
                explanation: "Petrol engines use spark ignition, while diesel engines use compression ignition."
            },
            {
                q: "Which fuel type is typically associated with higher compression ratios?",
                options: ["Petrol", "Diesel", "Both equally", "Neither"],
                answer: 1,
                explanation: "Diesel engines use higher compression ratios (16:1 to 20:1) compared to petrol engines (8:1 to 12:1)."
            },

            // 4.3 Main Parts of Engine and Its Functions
            {
                q: "Which of the following part is not present in a diesel engine?",
                options: ["Oil ring", "Spark plug", "Piston", "Fuel injector"],
                answer: 1,
                explanation: "Diesel engines use compression ignition, not spark plugs, which are found in petrol engines."
            },
            {
                q: "The camshaft of a 4-stroke I.C. engine running at 1500 rpm will run at:",
                options: ["3000 rpm", "750 rpm", "1500 rpm", "1000 rpm"],
                answer: 1,
                explanation: "The camshaft runs at half the crankshaft speed in a 4-stroke engine, so 1500 rpm ÷ 2 = 750 rpm."
            },
            {
                q: "The stroke of an engine is the:",
                options: ["Volume of the cylinder", "Distance between TDC and BDC", "Piston diameter", "Compression ratio"],
                answer: 1,
                explanation: "Stroke is the distance the piston travels between Top Dead Center (TDC) and Bottom Dead Center (BDC)."
            },
            {
                q: "Compression rings of automotive engines are generally made of:",
                options: ["High carbon steel", "Cast iron and steel", "Aluminum", "Brass"],
                answer: 1,
                explanation: "Compression rings are typically made of cast iron or steel for durability and heat resistance."
            },
            {
                q: "Compression ratio is the:",
                options: ["Swept volume to clearance volume", "Total volume to clearance volume", "Swept volume to total volume", "Clearance volume to swept volume"],
                answer: 1,
                explanation: "Compression ratio is the ratio of total volume (swept + clearance) to clearance volume."
            },
            {
                q: "If a four-cylinder engine has a capacity of 2.0 liters, what is the swept volume of a single cylinder?",
                options: ["800 cc", "500 cc", "1000 cc", "400 cc"],
                answer: 1,
                explanation: "2.0 liters = 2000 cc ÷ 4 cylinders = 500 cc per cylinder."
            },
            {
                q: "पिस्टनमा लाग्ने Compression ring को Gap मापन गर्न कुन उपकरण प्रयोग गरिन्छ? (Which tool is used to measure the gap of a compression ring on a piston?)",
                options: ["Vernier caliper", "Feeler gauge", "Micrometer", "Dial gauge"],
                answer: 1,
                explanation: "फिलर गेजले कम्प्रेसन रिङको ग्याप मापन गर्छ। (A feeler gauge measures the gap of a compression ring.)"
            },
            {
                q: "Cylinder Head को Compression Test गर्ने उपकरण कुन हो? (Which tool is used for a compression test on a cylinder head?)",
                options: ["Hydrometer", "Compression tester", "Multimeter", "Torque wrench"],
                answer: 1,
                explanation: "कम्प्रेसन टेस्टरले सिलिन्डरको चाप जाँच गर्छ। (A compression tester measures cylinder compression.)"
            },
            {
                q: "Machine parts like cylinders, piston rings, valves, crankshaft, connecting rod, governors, indicators, etc. are related to:",
                options: ["Petrol engine", "Steam engine", "Electric motor", "Hydraulic pump"],
                answer: 0,
                explanation: "These components are integral to internal combustion engines, such as petrol engines."
            },
            {
                q: "What is the primary function of the crankshaft in an engine?",
                options: ["Compress the air-fuel mixture", "Convert linear motion to rotary motion", "Regulate fuel injection", "Cool the engine"],
                answer: 1,
                explanation: "The crankshaft converts the piston's linear motion into rotary motion to drive the vehicle."
            },
            {
                q: "Which part of the engine seals the combustion chamber?",
                options: ["Piston", "Cylinder head", "Connecting rod", "Valve cover"],
                answer: 1,
                explanation: "The cylinder head seals the top of the combustion chamber, containing the valves and spark plug."
            },
            {
                q: "What is the role of the connecting rod in an engine?",
                options: ["Transfer heat", "Connect piston to crankshaft", "Regulate air intake", "Filter oil"],
                answer: 1,
                explanation: "The connecting rod links the piston to the crankshaft, transmitting motion and force."
            },
            {
                q: "Which component regulates the timing of valve opening and closing?",
                options: ["Camshaft", "Crankshaft", "Flywheel", "Piston"],
                answer: 0,
                explanation: "The camshaft controls the timing of valve operations in the engine cycle."
            },

            // 4.4 Identification of Need of Engine Overhaul
            {
                q: "Presence of water in the engine oil sump means:",
                options: ["Water in the fuel system", "Damaged head gasket", "Clogged air filter", "Faulty oil pump"],
                answer: 1,
                explanation: "A damaged head gasket allows coolant to leak into the oil sump, causing water contamination."
            },
            {
                q: "What symptom indicates excessive wear in engine bearings?",
                options: ["Low oil pressure", "High engine noise", "Overheating", "All of the above"],
                answer: 3,
                explanation: "Low oil pressure, high noise, and overheating can signal worn engine bearings requiring overhaul."
            },
            {
                q: "Blue exhaust smoke is a sign of what engine issue?",
                options: ["Oil burning", "Coolant leak", "Fuel dilution", "Air intake blockage"],
                answer: 0,
                explanation: "Blue smoke indicates oil burning, often due to worn piston rings or valve seals, suggesting overhaul."
            },
            {
                q: "What does a significant drop in compression across all cylinders indicate?",
                options: ["Normal wear", "Head gasket failure", "Worn piston rings", "Clogged fuel injector"],
                answer: 1,
                explanation: "A uniform drop in compression suggests a head gasket failure, necessitating an overhaul."
            },
            {
                q: "Loss of power and rough idling are symptoms of what engine condition?",
                options: ["Clean fuel system", "Worn valve seats", "New spark plugs", "Proper lubrication"],
                answer: 1,
                explanation: "Worn valve seats can cause power loss and rough idling, indicating overhaul need."
            },

            // 4.5 Purpose and Function of Supercharger and Turbocharger
            {
                q: "What is the primary purpose of a supercharger in an engine?",
                options: ["Reduce engine weight", "Increase air intake for more power", "Cool the engine", "Filter exhaust gases"],
                answer: 1,
                explanation: "A supercharger forces more air into the engine, enhancing power output."
            },
            {
                q: "How does a turbocharger differ from a supercharger?",
                options: ["Driven by exhaust gases vs. mechanically driven", "Lower power output", "Uses less fuel", "No difference"],
                answer: 0,
                explanation: "A turbocharger is driven by exhaust gases, while a supercharger is mechanically driven by the engine."
            },
            {
                q: "What is a common advantage of using a turbocharger?",
                options: ["Improved fuel efficiency at high loads", "Reduced engine size", "Lower maintenance", "Quieter operation"],
                answer: 0,
                explanation: "Turbochargers improve fuel efficiency and power at high loads by utilizing exhaust energy."
            },
            {
                q: "What effect does a supercharger have on engine performance at low RPM?",
                options: ["Decreases power", "Provides instant boost", "Increases emissions", "Reduces torque"],
                answer: 1,
                explanation: "A supercharger provides instant power boost at low RPM due to its direct mechanical drive."
            },
            {
                q: "Which component is essential for cooling a turbocharger?",
                options: ["Oil cooler", "Radiator", "Exhaust manifold", "Air filter"],
                answer: 0,
                explanation: "An oil cooler prevents overheating of the turbocharger by dissipating heat from the bearings."
            },
            {
                q: "What is a potential disadvantage of a turbocharger?",
                options: ["Turbo lag", "Excessive fuel consumption", "Reduced power", "Increased engine weight"],
                answer: 0,
                explanation: "Turbo lag, the delay in power delivery, is a common disadvantage due to exhaust-driven operation."
            },

            // 4.6 Troubleshooting
            {
                q: "Maximum oil pressure in the lubrication system is controlled by:",
                options: ["Oil filter", "Pressure relief valve", "Oil pump", "Crankshaft"],
                answer: 1,
                explanation: "The pressure relief valve regulates maximum oil pressure to prevent damage to the lubrication system."
            },
            {
                q: "The carbon from the cylinder head of an engine is removed with:",
                options: ["Soap", "Scraper", "Water jet", "Sandpaper"],
                answer: 1,
                explanation: "A scraper is used to remove carbon deposits from the cylinder head during maintenance."
            },
            {
                q: "The advantage of the fuel injection system over the carburetor system is:",
                options: ["Improved power output", "Better fuel efficiency", "Precise fuel delivery", "All of the above"],
                answer: 3,
                explanation: "Fuel injection systems offer better efficiency, precise delivery, and improved power compared to carburetors."
            },
            {
                q: "The carburetor supplies …… into the engine cylinder.",
                options: ["Air", "Air-fuel mixture", "Fuel only", "Coolant"],
                answer: 1,
                explanation: "The carburetor mixes air and fuel in the correct ratio and supplies it to the engine cylinder."
            },
            {
                q: "In which of the following is a fuel injector used?",
                options: ["Spark-ignition engines", "Compression-ignition engines", "Steam engines", "Electric engines"],
                answer: 1,
                explanation: "Fuel injectors are used in compression-ignition (diesel) engines for precise fuel delivery."
            },
            {
                q: "Which of the following is an indication of a problem in the fuel injection pump?",
                options: ["Difficulty starting", "Excessive smoke", "Reduced power", "All of the above"],
                answer: 3,
                explanation: "A faulty fuel injection pump can cause difficulty starting, excessive smoke, and reduced power."
            },
            {
                q: "The fuel injection timing in a distributor-type pump is controlled by:",
                options: ["Changing plunger stroke", "Rotating the cam ring", "Adjusting nozzle size", "Varying fuel pressure"],
                answer: 1,
                explanation: "Rotating the cam ring adjusts the timing of fuel injection in a distributor-type pump."
            },
            {
                q: "The secondary dry-type filter element of an engine of an excavator is cleaned:",
                options: ["With compressed air on the outer surface", "It is not cleaned but only changed as required", "By washing with water", "By brushing with a soft brush"],
                answer: 1,
                explanation: "Secondary dry-type filters are not cleaned; they are replaced when clogged to ensure engine protection."
            },
            {
                q: "गाडी स्टार्ट नहुने कारण के हुनसक्छ? (What could cause a vehicle not to start?)",
                options: ["इन्धन सकिनु (No fuel)", "एयर फिल्टर सफा नगरेको (Dirty air filter)", "टायरको कम चाप (Low tire pressure)", "रेडिएटरमा पानीको कमी (Low radiator water)"],
                answer: 0,
                explanation: "इन्धनको अभावले गाडी स्टार्ट हुँदैन। (Lack of fuel is a common reason for a vehicle not starting.)"
            },
            {
                q: "The following is considered as the best antifreeze solution:",
                options: ["Methanol", "Ethylene glycol", "Distilled water", "Glycerine"],
                answer: 1,
                explanation: "Ethylene glycol is the preferred antifreeze due to its effective freeze-point depression and heat transfer properties."
            }
        ];

        let currentPage = 0;
        let score = 0;
        let skipped = [];
        let userAnswers = Array(questions.length).fill(null);
        let timerSeconds = 0;
        let timerInterval;
        const QUESTIONS_PER_PAGE = 20; // Updated to 20 MCQs per page
        const ANSWER_DELAY = 1000;

        const quizEl = document.getElementById("quiz");
        const scoreEl = document.getElementById("score");
        const resultsEl = document.getElementById("results");
        const resultsBody = document.getElementById("results-body");
        const progressEl = document.getElementById("progress");
        const timerEl = document.getElementById("timer");
        const currentScoreEl = document.getElementById("current-score");
        const correctSound = document.getElementById("correct-sound");
        const wrongSound = document.getElementById("wrong-sound");

        function clearProgress() {
            localStorage.removeItem("quizProgressEngine");
            currentPage = 0;
            score = 0;
            skipped = [];
            userAnswers = Array(questions.length).fill(null);
            timerSeconds = 0;
        }

        function saveProgress() {
            localStorage.setItem("quizProgressEngine", JSON.stringify({
                currentPage,
                score,
                skipped,
                answers: userAnswers,
                time: timerSeconds
            }));
        }

        function updateCurrentScore() {
            currentScoreEl.textContent = `Score: ${score}/${questions.length}`;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timerSeconds++;
                const minutes = Math.floor(timerSeconds / 60);
                const seconds = timerSeconds % 60;
                timerEl.textContent = `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                saveProgress();
            }, 1000);
        }

        function updateProgress() {
            const answeredCount = userAnswers.filter(answer => answer !== null).length;
            const percentage = (answeredCount / questions.length) * 100;
            progressEl.style.width = `${percentage}%`;
        }

        function showQuestions(page) {
            quizEl.innerHTML = '';
            const startIndex = page * QUESTIONS_PER_PAGE;
            const endIndex = Math.min(startIndex + QUESTIONS_PER_PAGE, questions.length);

            for (let i = startIndex; i < endIndex; i++) {
                const q = questions[i];
                const shuffledOptions = shuffle([...q.options].map((opt, j) => ({ text: opt, index: j })));
                const optionsHtml = shuffledOptions
                    .map(opt => `<button onclick="checkAnswer(this, ${i}, ${opt.index}, '${opt.text.replace(/'/g, "\\'")}')">${opt.text}</button>`)
                    .join('');
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');
                questionDiv.dataset.index = i;
                questionDiv.innerHTML = `
                    <p>Q${i + 1}. ${q.q}</p>
                    <div class="options">${optionsHtml}</div>
                    <button class="skip-button" onclick="skipQuestion(${i})">Skip</button>
                    <div class="explanation">${q.explanation}</div>
                `;
                quizEl.appendChild(questionDiv);
            }

            if (endIndex < questions.length || skipped.length > 0) {
                const nextButton = document.createElement('button');
                nextButton.classList.add('next-button');
                nextButton.textContent = endIndex < questions.length ? 'Next' : 'Review Skipped Questions';
                nextButton.onclick = nextPage;
                nextButton.disabled = !areAllQuestionsAnsweredOnPage(startIndex, endIndex);
                quizEl.appendChild(nextButton);
            } else {
                const submitButton = document.createElement('button');
                submitButton.classList.add('next-button');
                submitButton.textContent = 'Submit Quiz';
                submitButton.onclick = endQuiz;
                submitButton.disabled = !areAllQuestionsAnsweredOnPage(startIndex, endIndex);
                quizEl.appendChild(submitButton);
            }

            updateProgress();
            saveProgress();
            restoreAnswers(startIndex, endIndex);
        }

        function restoreAnswers(startIndex, endIndex) {
            for (let i = startIndex; i < endIndex; i++) {
                if (userAnswers[i] !== null && userAnswers[i] !== 'Skipped') {
                    const questionDiv = document.querySelector(`.question[data-index="${i}"]`);
                    const buttons = questionDiv.querySelectorAll('.options button');
                    const q = questions[i];
                    buttons.forEach(btn => {
                        btn.disabled = true;
                        if (btn.textContent === q.options[q.answer]) {
                            btn.classList.add('correct');
                        }
                        if (btn.textContent === userAnswers[i] && userAnswers[i] !== q.options[q.answer]) {
                            btn.classList.add('wrong');
                        }
                    });
                    questionDiv.querySelector('.explanation').style.display = 'block';
                    questionDiv.querySelector('.skip-button').disabled = true;
                } else if (userAnswers[i] === 'Skipped') {
                    const questionDiv = document.querySelector(`.question[data-index="${i}"]`);
                    questionDiv.querySelectorAll('.options button').forEach(btn => btn.disabled = true);
                    questionDiv.querySelector('.skip-button').disabled = true;
                    questionDiv.querySelector('.explanation').style.display = 'block';
                }
            }
        }

        function areAllQuestionsAnsweredOnPage(startIndex, endIndex) {
            for (let i = startIndex; i < endIndex; i++) {
                if (userAnswers[i] === null) {
                    return false;
                }
            }
            return true;
        }

        function checkAnswer(button, questionIndex, selected, selectedText) {
            const q = questions[questionIndex];
            const correct = q.answer;
            const buttons = button.parentElement.querySelectorAll("button");
            const questionDiv = button.closest('.question');
            const explanationDiv = questionDiv.querySelector('.explanation');

            buttons.forEach(btn => {
                btn.disabled = true;
                if (q.options.indexOf(btn.textContent) === correct) {
                    btn.classList.add('correct');
                }
                if (btn === button && selected !== correct) {
                    btn.classList.add('wrong');
                }
            });

            questionDiv.querySelector('.skip-button').disabled = true;
            explanationDiv.style.display = 'block';

            userAnswers[questionIndex] = selectedText;
            if (selected === correct) {
                score++;
                correctSound.play().catch(() => console.log("Audio playback failed"));
            } else {
                wrongSound.play().catch(() => console.log("Audio playback failed"));
            }

            updateCurrentScore();
            saveProgress();
            const nextButton = quizEl.querySelector('.next-button');
            if (nextButton) {
                nextButton.disabled = !areAllQuestionsAnsweredOnPage(
                    currentPage * QUESTIONS_PER_PAGE,
                    Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, questions.length)
                );
            }

            setTimeout(() => {
                if (areAllQuestionsAnsweredOnPage(
                    currentPage * QUESTIONS_PER_PAGE,
                    Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, questions.length)
                )) {
                    nextPage();
                }
            }, ANSWER_DELAY);
        }

        function skipQuestion(questionIndex) {
            if (!skipped.includes(questions[questionIndex])) {
                skipped.push(questions[questionIndex]);
                userAnswers[questionIndex] = 'Skipped';
                const questionDiv = document.querySelector(`.question[data-index="${questionIndex}"]`);
                if (questionDiv) {
                    questionDiv.querySelectorAll('.options button').forEach(btn => btn.disabled = true);
                    questionDiv.querySelector('.skip-button').disabled = true;
                    questionDiv.querySelector('.explanation').style.display = 'block';
                }
                saveProgress();
                const nextButton = quizEl.querySelector('.next-button');
                if (nextButton) {
                    nextButton.disabled = !areAllQuestionsAnsweredOnPage(
                        currentPage * QUESTIONS_PER_PAGE,
                        Math.min((currentPage + 1) * QUESTIONS_PER_PAGE, questions.length)
                    );
                }
            }
        }

        function nextPage() {
            if (skipped.length > 0 && currentPage * QUESTIONS_PER_PAGE >= questions.length) {
                showSkippedQuestions();
            } else {
                currentPage++;
                if (currentPage * QUESTIONS_PER_PAGE < questions.length) {
                    showQuestions(currentPage);
                } else if (skipped.length === 0) {
                    endQuiz();
                } else {
                    showSkippedQuestions();
                }
            }
        }

        function showSkippedQuestions() {
            questions.splice(0, questions.length, ...skipped);
            skipped = [];
            currentPage = 0;
            showQuestions(currentPage);
        }

        function endQuiz() {
            clearInterval(timerInterval);
            quizEl.innerHTML = '';
            scoreEl.textContent = `Final Score: ${score} out of ${questions.length} (${((score / questions.length) * 100).toFixed(2)}%)`;
            resultsEl.classList.remove('hidden');

            resultsBody.innerHTML = questions.map((q, i) => {
                const userAnswer = userAnswers[i] === null ? 'Not attempted' :
                                  userAnswers[i] === 'Skipped' ? 'Skipped' :
                                  userAnswers[i];
                const correctAnswer = q.options[q.answer];
                const status = userAnswers[i] === q.options[q.answer] ? 'Correct' :
                              userAnswers[i] === 'Skipped' ? 'Skipped' :
                              userAnswers[i] === null ? 'Not-attempted' : 'Wrong';
                return `
                    <tr>
                        <td>${i + 1}. ${q.q}</td>
                        <td>${userAnswer}</td>
                        <td>${correctAnswer}</td>
                        <td class="${status.toLowerCase().replace(' ', '-')}">${status}</td>
                        <td class="explanation">${q.explanation}</td>
                    </tr>
                `;
            }).join('');

            localStorage.removeItem('quizProgressEngine');
        }

        function restartQuiz() {
            clearProgress();
            resultsEl.classList.add('hidden');
            scoreEl.textContent = '';
            startTimer();
            showQuestions(currentPage);
            updateCurrentScore();
        }

        function initialize() {
            clearProgress();
            startTimer();
            showQuestions(currentPage);
            updateCurrentScore();
        }

        initialize();
    </script>
</body>
</html>
